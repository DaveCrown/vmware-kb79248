---
- name: Download file from vmware
  block:
    - name: get check script
      get_url: 
        url: "{{ script_urls.checksts }}"
        dest: "{{ ansible_user_dir }}/checksts.py"
        mode: '0644'
  rescue:
    - name: make a work dir
      file:
        state: directory
        path: "{{ playbook_dir }}/work"
      delegate_to: localhost

    - name: get check script
      get_url: 
        url: "{{ script_urls.checksts }}"
        dest: "{{ playbook_dir }}/work/checksts.py"
        mode: '0644'
      delegate_to: localhost

    - name: copy file to server
      copy:
        src: "{{ playbook_dir }}/work/checksts.py"
        dest:  "{{ ansible_user_dir }}/checksts.py"

- name: run the checksts.py script
  shell:
    cmd: python {{ ansible_user_dir }}/checksts.py
  register: check_sts_results
  changed_when: False